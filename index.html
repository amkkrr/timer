<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>计时器应用</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <div class="button-container">
        <button id="toggleButton">开始计时</button>
        <div id="timerDisplay">00:00:00</div>
    </div>

    <div id="purposeContainer" style="display: none;">
        <input type="text" id="purposeInput" placeholder="请输入计时目的">
        <button id="submitPurpose">提交</button>
    </div>

    <div id="recordsContainer">
        <div id="recordsHeader">
            <div class="startTime">开始时间</div>
            <div class="endTime">结束时间</div>
            <div class="duration">用时</div>
            <div class="purpose">计时目的</div>
            <div class="actions">操作</div>
        </div>
        <div id="records"></div>
    </div>

    <script>
        const toggleButton = document.getElementById('toggleButton');
        const timerDisplay = document.getElementById('timerDisplay');
        const purposeContainer = document.getElementById('purposeContainer');
        const purposeInput = document.getElementById('purposeInput');
        const submitPurpose = document.getElementById('submitPurpose');
        const records = document.getElementById('records');

        let timerInterval = null;
        let startTime = null;
        let elapsedTime = 0;

        toggleButton.addEventListener('click', () => {
            if (!timerInterval) {
                startTimer();
            } else {
                stopTimer();
            }
        });

        function startTimer() {
            startTime = Date.now() - elapsedTime;
            toggleButton.textContent = '停止计时';
            toggleButton.classList.add('stop');
            timerInterval = setInterval(updateTimer, 1000);
            purposeContainer.style.display = 'none';
        }

        function stopTimer() {
            clearInterval(timerInterval);
            timerInterval = null;
            elapsedTime = Date.now() - startTime;
            toggleButton.textContent = '开始计时';
            toggleButton.classList.remove('stop');
            timerDisplay.textContent = formatTime(elapsedTime);
            purposeContainer.style.display = 'flex';
        }

        function updateTimer() {
            const currentTime = Date.now();
            elapsedTime = currentTime - startTime;
            timerDisplay.textContent = formatTime(elapsedTime);
        }

        function formatTime(ms) {
            const totalSeconds = Math.floor(ms / 1000);
            const hours = String(Math.floor(totalSeconds / 3600)).padStart(2, '0');
            const minutes = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, '0');
            const seconds = String(totalSeconds % 60).padStart(2, '0');
            return `${hours}:${minutes}:${seconds}`;
        }

        submitPurpose.addEventListener('click', () => {
            const purpose = purposeInput.value.trim();
            if (purpose === '') {
                alert('请填写计时目的');
                return;
            }

            const endTime = new Date(startTime + elapsedTime);
            const startDate = new Date(startTime);

            const record = document.createElement('div');
            record.classList.add('record');
            record.innerHTML = `
                <div class="startTime">${startDate.toLocaleString()}</div>
                <div class="endTime">${endTime.toLocaleString()}</div>
                <div class="duration">${formatTime(elapsedTime)}</div>
                <div class="purpose">${purpose}</div>
                <div class="actions"><button class="deleteButton">删除</button></div>
            `;
            records.prepend(record);

            // 清空输入并隐藏目的输入区域
            purposeInput.value = '';
            purposeContainer.style.display = 'none';
            timerDisplay.textContent = '00:00:00';
            elapsedTime = 0;
        });

        // 保持计时即使页面被切换到后台
        document.addEventListener('visibilitychange', () => {
            if (timerInterval) {
                updateTimer();
            }
        });

        // 使用事件委托处理删除按钮点击事件
        records.addEventListener('click', (e) => {
            if (e.target && e.target.classList.contains('deleteButton')) {
                if (confirm('确认删除该记录吗？')) {
                    e.target.closest('.record').remove();
                }
            }
        });
    </script>

</body>
</html>
